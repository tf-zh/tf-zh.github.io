(self.webpackChunktensorflow_model=self.webpackChunktensorflow_model||[]).push([[433],{46917:function(C,S,e){"use strict";e.r(S),e.d(S,{default:function(){return oe}});var K=e(90228),f=e.n(K),X=e(87999),y=e.n(X),z=e(48305),b=e.n(z),H=e(36075),Q=e.n(H),p=e(75271),W=e(61228),P=e(85401),Re=e(28620),De=e(31659),Y=e(76212),q=e(52607),B=e(59090),x=e(46404),_=e(11538),ee=e(33863),Pe=e(12833),ae=e.p+"static/iloveyou.dbb7df57.mov",ne=e.p+"static/fku.a57ec9ab.mp3",re=e.p+"static/youarebad.e6f4ab59.mp3",te=e.p+"static/baby.1c5de903.jpeg",se=e.p+"static/gangsta.f5a1076a.webp",ie=e.p+"static/ybadbad.e3aa2e42.webp",u=e(52676),j="common",E=-1,le=3,A=null,c=Y.create(),ue=function(ce){Q()(ce);var de=(0,p.useReducer)(function(t){return t+1},0),fe=b()(de,2),ve=fe[1],me=(0,p.useState)([{label:"normal",count:0,similar:0},{label:"gangsta",count:0,similar:0},{label:"middleFinger",count:0,similar:0},{label:"giveEgg",count:0,similar:0}]),M=b()(me,2),N=M[0],pe=M[1],F=(0,p.useRef)(null),ge=(0,p.useState)(!1),T=b()(ge,2),he=T[0],L=T[1],ye=(0,p.useState)(!1),U=b()(ye,2),Z=U[0],be=U[1],je=(0,p.useState)(void 0),k=b()(je,2),O=k[0],V=k[1],Ce=(0,p.useState)(void 0),$=b()(Ce,2),I=$[0],J=$[1],w=(0,p.useRef)(),Fe=(0,_.Z)(function(t){var s=new Map([["gangsta",ne],["middleFinger",re],["giveEgg",ae]]),n=new Map([["gangsta",se],["middleFinger",ie],["giveEgg",te]]);if(Z&&w.current){var a=t.find(function(i){return i.similar>.6});if(!a)return;w.current.src=s.get(a.label),!O&&V(a.label),!O&&J(n.get(a.label)),w.current.onended=function(){V(void 0),J(void 0)},O&&w.current.play()}},{wait:2e3}),we=Fe.run,Se=function(){var t=y()(f()().mark(function s(n){var a,i,r;return f()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)){l.next=2;break}throw new Error("Browser API navigator.mediaDevices.getUserMedia not available");case 2:return a=n.el,a.width=n.w||300,a.height=n.h||250,i=(0,ee.isMobile)(),l.next=8,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user",width:i?void 0:a.width,height:i?void 0:a.width}});case 8:return r=l.sent,a.srcObject=r,l.abrupt("return",new Promise(function(d){a.onloadedmetadata=function(){d(a)}}));case 11:case"end":return l.stop()}},s)}));return function(n){return t.apply(this,arguments)}}(),Ee=function(){var t=y()(f()().mark(function s(n){return f()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:E=n;case 1:case"end":return i.stop()}},s)}));return function(n){return t.apply(this,arguments)}}(),xe=function(){var t=y()(f()().mark(function s(n){var a,i;return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(a=n.target.files[0],a){o.next=3;break}return o.abrupt("return");case 3:i=new FileReader,i.onload=function(l){try{var d,m=l==null||(d=l.target)===null||d===void 0?void 0:d.result,h=JSON.parse(m),v={};h.forEach(function(g){v[g.label]=P.tensor2d(g.data)}),c.setClassifierDataset(v)}catch(g){alert("\u65E0\u6CD5\u89E3\u6790 JSON \u6587\u4EF6: "+g.message)}},i.readAsText(a);case 6:case"end":return o.stop()}},s)}));return function(n){return t.apply(this,arguments)}}(),Ae=function(){var t=y()(f()().mark(function s(){var n,a,i,r,o,l,d,m,h;return f()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:n=c.getClassifierDataset(),console.log("modelData",n),a=[];for(i in n)r=n[i],o=r.arraySync(),a.push({data:o,label:i});l=JSON.stringify(a),d=new Blob([l],{type:"application/json"}),m=URL.createObjectURL(d),h=document.createElement("a"),h.href=m,h.download="knn_model.json",h.click(),URL.revokeObjectURL(m);case 12:case"end":return g.stop()}},s)}));return function(){return t.apply(this,arguments)}}();function G(){return R.apply(this,arguments)}function R(){return R=y()(f()().mark(function t(){var s,n,a,i,r,o,l,d,m;return f()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(F.current){v.next=2;break}return v.abrupt("return");case 2:if(s=P.browser.fromPixels(F.current),a=function(){var D;return(D=A)===null||D===void 0?void 0:D.infer(s,"conv_preds")},E!=-1&&(n=a(),c==null||c.addExample(n,E),E=-1),i=(c==null?void 0:c.getNumClasses())||0,!(i>0)){v.next=16;break}return n=a(),v.next=10,c==null?void 0:c.predictClass(n,le);case 10:for(r=v.sent,o=N,l=0;l<o.length;l++){d=c==null?void 0:c.getClassExampleCount();for(m in d)Object.prototype.hasOwnProperty.call(d,m)&&o[l].label===m&&(o[l].count=d[m],o[l].similar=r.confidences[m]*100)}pe(o),we(o),ve();case 16:s.dispose(),n!=null&&n.dispose(),requestAnimationFrame(G);case 19:case"end":return v.stop()}},t)})),R.apply(this,arguments)}var Oe=function(){var t=y()(f()().mark(function s(){var n,a;return f()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,W.load();case 2:if(n=r.sent,A=n,A){r.next=6;break}return r.abrupt("return");case 6:if(r.prev=6,F.current){r.next=9;break}return r.abrupt("return");case 9:return r.next=11,Se({el:F.current});case 11:a=r.sent,a.play(),G(),L(!1),r.next=20;break;case 17:throw r.prev=17,r.t0=r.catch(6),r.t0;case 20:case"end":return r.stop()}},s,null,[[6,17]])}));return function(){return t.apply(this,arguments)}}();return(0,p.useEffect)(function(){L(!0),Oe()},[]),(0,u.jsxs)("div",{className:j,children:[he&&(0,u.jsx)("div",{className:"".concat(j,"-loading"),children:"loading..."}),(0,u.jsxs)("div",{className:"".concat(j,"-main"),children:[(0,u.jsxs)("div",{className:"".concat(j,"-cont"),children:[I&&(0,u.jsx)(q.Z,{rootClassName:"".concat(j,"-cont-pic"),preview:!1,src:I,width:150,height:120}),(0,u.jsx)("video",{ref:F,playsInline:!0,style:{transform:"scaleX(-1)"}})]}),(0,u.jsx)("ul",{children:N.map(function(t){return(0,u.jsx)("li",{children:(0,u.jsxs)(B.Z,{gap:"middle",children:[(0,u.jsxs)(x.ZP,{style:{marginBottom:8},onClick:function(){return Ee(t.label)},children:["\u5582\u6295\u6A21\u578B\uFF1A",t.label]}),(0,u.jsxs)("span",{style:{marginBottom:8},children:["\u6837\u672C\u6570\u91CF\uFF1A",t.count]}),(0,u.jsxs)("span",{style:{marginBottom:8},children:["\u76F8\u4F3C\u5EA6\uFF1A",t.similar&&t.similar.toFixed(2)," %"]})]})},t.label)})}),(0,u.jsxs)(B.Z,{gap:8,vertical:!0,className:"".concat(j,"-btns"),children:[(0,u.jsxs)("label",{children:[(0,u.jsx)("span",{children:"\u5BFC\u5165\u6A21\u578B\uFF1A"}),(0,u.jsx)("input",{placeholder:"\u5F15\u5165\u6587\u4EF6",type:"file",onChange:function(s){return xe(s)},accept:".json"})]}),(0,u.jsx)(x.ZP,{type:Z?"default":"primary",style:{marginRight:8},onClick:function(){return be(function(s){return!s})},children:"\u5F00\u59CB\u6D4B\u8BD5"}),(0,u.jsx)(x.ZP,{type:"primary",style:{marginRight:8},onClick:function(){return Ae()},children:"\u5BFC\u51FA\u6A21\u578B"})]}),(0,u.jsx)("audio",{ref:w,crossOrigin:"anonymous"})]})]})},oe=ue},36075:function(C){function S(e){if(e==null)throw new TypeError("Cannot destructure "+e)}C.exports=S,C.exports.__esModule=!0,C.exports.default=C.exports}}]);
